---
title: ä¼šç¤¾ã®Notionã‹ã‚‰å€‹äººGitHubãƒªãƒã‚¸ãƒˆãƒªã¸è‡ªå‹•çš„ã«è¨˜äº‹ã‚’åæ˜ ã•ã›ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç´¹ä»‹ã™ã‚‹
emoji: ğŸ’½
type: tech
topics: [GHA, github, notion]
published: true
publication_name: "pubtech"
---


# ä¼šç¤¾ã®Notionã‹ã‚‰Zennã¸ã®è¨˜äº‹å…¬é–‹ã‚’è‡ªå‹•åŒ–ã™ã‚‹ä»•çµ„ã¿


Zennã§ã¯ã€è‡ªèº«ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã¨è¨˜äº‹ã‚’é€£æºã•ã›ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç®¡ç†ã§ãã¾ã™ã€‚è©³ç´°ãªè¨­å®šæ–¹æ³•ã¯å…¬å¼ã‚¬ã‚¤ãƒ‰ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ãŒã€å€‹ã€…äººãŒä¼šç¤¾ã®è¨˜äº‹ã‚’ç®¡ç†ã™ã‚‹ã¨ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„å“è³ªãŒä¸ååˆ†ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä¼šç¤¾ã§ä½œæˆã—ãŸæŠ€è¡“è¨˜äº‹ã¯ä¼šç¤¾ã®è³‡ç”£ã¨è¦‹ãªã•ã‚Œã‚‹ã¹ãã§ã‚ã‚Šã€ãã®å“è³ªã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«ã€ä¼šç¤¾ã§ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä½“åˆ¶ã‚’è¨­ã‘ã‚‹ã“ã¨ãŒé‡è¦ã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚


ã“ã®ã‚ˆã†ãªä½“åˆ¶ã‚’æ•´ãˆã‚‹ãŸã‚ã«ã€Notionã‹ã‚‰GitHubã‚’é€šã˜ã¦Zennã¸è¨˜äº‹ã‚’è‡ªå‹•ã§å…¬é–‹ã™ã‚‹ä»•çµ„ã¿ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚


## æµã‚Œ

1. **ä¼šç¤¾ã®Notionã«è¨˜äº‹ã‚’æŠ•ç¨¿ã™ã‚‹**

	ã¾ãšã€ä¼šç¤¾ã®Notionã‚¹ãƒšãƒ¼ã‚¹ã«è¨˜äº‹ã‚’æŠ•ç¨¿ã—ã¾ã™ã€‚

2. **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä¾é ¼ã™ã‚‹**

	æŠ•ç¨¿å¾Œã€ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«ç°¡æ˜“ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä¾é ¼ã—ã¾ã™ã€‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®Œäº†ã—ãŸã‚‰ã€è¨˜äº‹ã®`Status`ã‚’`å…¬é–‹`ã«è¨­å®šã—ã¾ã™ã€‚

3. **GitHub ActionsãŒå®šæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹**

	è¨˜äº‹ãŒå…¬é–‹çŠ¶æ…‹ã«ãªã‚‹ã¨ã€GitHub Actionsï¼ˆGHAï¼‰ãŒå®šæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚GHAã¯Notionã®è¨˜äº‹ã‚’Markdownå½¢å¼ã§GitHubãƒªãƒã‚¸ãƒˆãƒªã«ä¿å­˜ã—ã¾ã™ã€‚


	ä¾‹: `https://github.com/exxinc/pubtech-techblog/blob/main/articles/yoshiki-0428/test________.md`

4. **å€‹äººGitHubãƒªãƒã‚¸ãƒˆãƒªã«PRãŒä½œæˆã•ã‚Œã‚‹**

	GHAãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€å€‹äººã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆPRï¼‰ãŒè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã™ã€‚


	ä¾‹: `https://github.com/yoshiki-0428/zenn_repos/pull/3`

5. **PRã‚’ãƒãƒ¼ã‚¸ã™ã‚‹**

	PRã‚’è‡ªåˆ†ã§ç¢ºèªã—ã€å•é¡ŒãŒãªã‘ã‚Œã°ãƒãƒ¼ã‚¸ã—ã¾ã™


	![https://res.cloudinary.com/dlg4qjsyv/image/upload/f_auto,q_auto/ce1rzimy6vv9cepdposw?_a=BAMCkGJu0](https://res.cloudinary.com/dlg4qjsyv/image/upload/f_auto,q_auto/ce1rzimy6vv9cepdposw?_a=BAMCkGJu0)

6. **Zennã§è¨˜äº‹ãŒå…¬é–‹ã•ã‚Œã‚‹**

	Zennã¨ã®é€£æºãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã¨ã€ãƒãƒ¼ã‚¸å¾Œã«Zennä¸Šã§è¨˜äº‹ãŒå…¬é–‹ã•ã‚Œã¾ã™ã€‚


	
@[card](https://zenn.dev/zenn/articles/connect-to-github)
	


```mermaid
graph LR
    N[ä¼šç¤¾Notion] --> R[ä¼šç¤¾Repo]
    R --> G[GitHub Actions]
    G --> PR[PRä½œæˆ]
    PR --> M[è‡ªèº«ã®Repo]

```


### ä½œæˆã—ãŸGHA


ä¼šç¤¾ç”¨ã®Repositoryã§è¨˜äº‹ã‚’markdownã§ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚`articles/[username]`ã®ã‚ˆã†ã«ã—ã¦ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚ å¾Œã€…ä¼šç¤¾ç”¨ã®Tech Blogã‚’ç«‹ã¡ä¸Šã’ãŸã„ã¨ãªã£ã¦ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚


åŸºæœ¬çš„ã«å…¬é–‹ã—ã¦ã‹ã‚‰ã§ãªã„ã¨ã‚³ãƒŸãƒƒãƒˆã•ã‚Œãªã„ã®ã§notionã®é‹ç”¨ã‚’æ°—ã‚’ã¤ã‘ã‚Œã°ã€å¤§ä¸ˆå¤«ãªã¯ãšã§ã™ã€‚


```yaml
name: Publish Notion Articles to Multiple Repos

on:
  push:
    branches:
      - main
  workflow_dispatch: {}  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
  schedule:
    - cron: '0 0 * * *'

jobs:
  generate-articles:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4.2.2

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1

      - name: Install Dependencies
        run: bun install

      - name: Run Notion to Markdown Script
        env:
          PERSONAL_NOTION_TOKEN: ${{ secrets.PERSONAL_NOTION_TOKEN }}
          PERSONAL_NOTION_DATABASE_ID: ${{ secrets.PERSONAL_NOTION_DATABASE_ID }}
          CLOUDINARY_CLOUD_NAME: ${{ secrets.CLOUDINARY_CLOUD_NAME }}
          CLOUDINARY_API_KEY: ${{ secrets.CLOUDINARY_API_KEY }}
          CLOUDINARY_API_SECRET: ${{ secrets.CLOUDINARY_API_SECRET }}
        run: bun run scripts/index.ts

      - name: Commit and Push Changes
        run: |
          git config --local user.email "zenn-bot@github.com"
          git config --local user.name "zenn-bot"
          git add .
          if ! git diff --cached --quiet; then
            git commit -m "Update articles from Notion"
            git push
          else
            echo "No changes to commit."
          fi

  create-prs:
    needs: generate-articles
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repo:
          - { owner: 'yoshiki-0428', name: 'zenn_repos', token: 'GH_REPO_TOKEN_YOSHIKI' }
          # å¿…è¦ãªæ•°ã ã‘è¿½åŠ 
          # - { owner: 'owner2', name: 'repo2', token: 'TARGET_REPO2_TOKEN' }
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4.2.2
        with:
          ref: ${{ github.ref }}

      - name: Checkout Target Repository
        uses: actions/checkout@v4.2.2
        with:
          repository: ${{ matrix.repo.owner }}/${{ matrix.repo.name }}
          token: ${{ secrets[matrix.repo.token] }}
          path: target-repo

      - name: Copy Articles into Target Repo
        run: |
          cp -r articles/${{ matrix.repo.owner }}/* target-repo/articles/
        working-directory: ${{ github.workspace }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets[matrix.repo.token] }}
          commit-message: "Update articles from Pubtech Notion"
          branch: notion-update-${{ github.run_number }}
          title: "Update Articles from Notion"
          body: "Automatically generated PR with updated articles."
          base: main
          path: "target-repo/"
          add-paths: "*.md"

```


### notionã®å†…å®¹ã‚’markdownã«å¤‰æ›ã™ã‚‹å‡¦ç†


ä»Šå›ã¯nodeã®`notion-to-md` ã¨`@notionhq/client` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

- è¡Œã£ã¦ã„ã‚‹ã“ã¨ã¯notionã«å¿…è¦é …ç›®ãŒæƒã£ã¦ã„ã‚‹ã‹

```typescript
          {
            property: 'Status',
            status: { equals: 'å…¬é–‹' }
          },
          {
            property: 'User Name',
            select: { is_not_empty: true }
          },
          {
            property: 'ZennType',
            select: { is_not_empty: true }
          },
          {
            property: 'Tags',
            multi_select: { is_not_empty: true }
          },
          {
            property: 'Slug',
            rich_text: { is_not_empty: true }
          }
```

- æƒã£ã¦ã„ã‚Œã°ã€pageã‚’ã‚¯ã‚¨ãƒªã—ã¦
- Zennç”¨ã«ã‚ã£ãŸfrontMatterã‚’ä½œæˆã—ã¦

```typescript
      const frontMatter = `---
title: ${title}
emoji: ${page.icon?.emoji ?? 'ğŸ“'}
type: ${zennType}
topics: [${page.properties.Tags.multi_select.map((tag: any) => tag.name).join(', ')}]
published: true
publication_name: "pubtech"
---

`;
```

- zennç”¨ã®markdownã«å¤‰æ›ã™ã‚‹

:::message
toggleã®å ´åˆã¯ã€notion-to-mdãŒå¯¾å¿œã—ã¦ã„ãªã„ã‚‰ã—ãã€æ­£è¦è¡¨ç¾ã§å¯¾å¿œã—ã¾ã—ãŸ
:::


```typescript
      const content = frontMatter + mdString.parent
        // callout ğŸ’¡ã®å ´åˆã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        .replace(/:::message
(.+)/g, (match, p1) => {
:::
          return `:::message\n${p1}\n:::`; })
        // callout âš ï¸ã®å ´åˆã€è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        .replace(/:::message alert
(.+)/g, (match, p1) => {
:::
          return `:::message alert\n${p1}\n:::`; })
        // toggle ã®å ´åˆã€details ã«å¤‰æ›
        .replace(/<details>\n<summary>(.*?)<\/summary>(.*?)<\/details>/gs, (match, summary, content) => {
        return `:::details ${summary}
${content}
:::`;
      });
```



@[card](https://github.com/souvikinator/notion-to-md/issues/98)


:::details ã‚³ãƒ¼ãƒ‰ãŒé•·ã„ã®ã§å…¨éƒ¨ã¯ã“ã¡ã‚‰ã«


```typescript
(async () => {
  try {
    // ä¾‹ï¼šStatus ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ "å…¬é–‹" ã‹ã¤ã€ZennTypeãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ã‚’å–å¾—
    const response = await notion.databases.query({
      database_id: databaseId,
      filter: {
        and: [
          {
            property: 'Status',
            status: { equals: 'å…¬é–‹' }
          },
          {
            property: 'User Name',
            select: { is_not_empty: true }
          },
          {
            property: 'ZennType',
            select: { is_not_empty: true }
          },
          {
            property: 'Tags',
            multi_select: { is_not_empty: true }
          },
          {
            property: 'Slug',
            rich_text: { is_not_empty: true }
          }
        ]
      },
    });
    const pages = response.results as any[];

    console.log('published articles:', pages.length);

    // Notionã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸslugã®ä¸€è¦§ã‚’ä¿æŒã™ã‚‹é…åˆ—
    const generatedSlugs = new Set<string>();

    for (const page of pages) {
      const pageId: string = page.id;

      // ã‚¿ã‚¤ãƒˆãƒ«å–å¾—
      const title: string = page.properties["åå‰"].title[0].plain_text;

      // User Name ã‚’å–å¾—
      const userName: string = page.properties["User Name"].select.name;

      // ãƒ•ã‚¡ã‚¤ãƒ«åç”¨ã® Raw Slugï¼ˆãªã‘ã‚Œã° pageId ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ï¼‰
      const slugProp = page.properties.Slug;
      const rawSlug: string =
          (slugProp && slugProp.rich_text?.[0]?.plain_text.replace(/\s+/g, '-')) ||
          pageId.replace(/-/g, '');
      // ãƒ«ãƒ¼ãƒ«ã«å‰‡ã£ã¦slugã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ã™ã‚‹
      const slug = cleanSlug(rawSlug);
      generatedSlugs.add(slug);

      // notion-to-md ã§ãƒšãƒ¼ã‚¸å†…å®¹ã‚’ Markdown ã«å¤‰æ›
      const mdBlocks = await n2m.pageToMarkdown(pageId);
      const mdString = n2m.toMarkdownString(mdBlocks);

      // zenn type ã®å–å¾—
      const zennType = page.properties.ZennType.select.name;

      // Zenn ç”¨ Front Matter ã®ç”Ÿæˆ
      const frontMatter = `---
title: ${title}
emoji: ${page.icon?.emoji ?? 'ğŸ“'}
type: ${zennType}
topics: [${page.properties.Tags.multi_select.map((tag: any) => tag.name).join(', ')}]
published: true
publication_name: "pubtech"
---

`;
      if (!mdString.parent) {
        console.error(`Error: ${title} has no content.`);
        continue;
      }
      // zennç”¨ã®markdownã«å¤‰æ›
      const content = frontMatter + mdString.parent
        // callout ğŸ’¡ã®å ´åˆã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        .replace(/:::message
(.+)/g, (match, p1) => {
:::
          return `:::message\n${p1}\n:::`; })
        // callout âš ï¸ã®å ´åˆã€è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        .replace(/:::message alert
(.+)/g, (match, p1) => {
:::
          return `:::message alert\n${p1}\n:::`; })
        // toggle ã®å ´åˆã€details ã«å¤‰æ›
        .replace(/<details>\n<summary>(.*?)<\/summary>(.*?)<\/details>/gs, (match, summary, content) => {
        return `:::details ${summary}
${content}
:::`;
      });

      // â€» mdString.parent ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã¯ã€notion-to-md ã®å‡ºåŠ›æ§‹é€ ã«åˆã‚ã›ã¦ã„ã¾ã™ã€‚
      // const content = frontMatter + mdString.parent;

      // User Name ã”ã¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
      const userDir = path.join('articles', userName);
      if (!fs.existsSync(userDir)) {
        fs.mkdirSync(userDir, { recursive: true });
      }

      // ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡ºåŠ›
      const filePath = path.join(userDir, `${slug}.md`);
      fs.writeFileSync(filePath, content, 'utf8');
      console.log(`File created: ${filePath}`);
    }

    // æ—¢å­˜ã®articlesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®.mdãƒ•ã‚¡ã‚¤ãƒ«ã‚’èµ°æŸ»ã—ã€
    // ç”Ÿæˆã•ã‚ŒãŸslugã«å«ã¾ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹
    const files = fs.readdirSync('articles');
    for (const file of files) {
      const userDirPath = path.join('articles', file);
      const stats = fs.statSync(userDirPath);
      if (stats.isDirectory()) {
        const userFiles = fs.readdirSync(userDirPath);
        for (const userFile of userFiles) {
          const baseName = path.basename(userFile, '.md');
          if (!generatedSlugs.has(baseName)) {
            const filePath = path.join(userDirPath, userFile);
            fs.unlinkSync(filePath);
            console.log(`Deleted obsolete file: ${filePath}`);
          }
        }
      }
    }
  } catch (error) {
    console.error('Error occurred:', error);
    process.exit(1);
  }
})();

```



:::


ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã§å…¬é–‹ã‚’ã—ã¦ã„ã¾ã™ã€‚å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚



@[card](https://github.com/exxinc/pubtech-techblog)



:::message
ã“ã®è¨˜äº‹ã§æä¾›ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚„æ‰‹é †ã‚’ä½¿ç”¨ã—ãŸã“ã¨ã«ã‚ˆã£ã¦ç™ºç”Ÿã—ãŸã„ã‹ãªã‚‹æå®³ã«ã¤ã„ã¦ã‚‚ã€è‘—è€…ãŠã‚ˆã³é–¢ä¿‚è€…ã¯ä¸€åˆ‡è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚åˆ©ç”¨è€…ã¯ã€è‡ªå·±è²¬ä»»ã«ãŠã„ã¦ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã‚‚ã®ã¨ã—ã€å‹•ä½œã‚„çµæœã«ã¤ã„ã¦ååˆ†ã«ãƒ†ã‚¹ãƒˆã‚’è¡Œã£ã¦ã‹ã‚‰æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚æä¾›ã•ã‚ŒãŸå†…å®¹ã¯ã‚ãã¾ã§å‚è€ƒæƒ…å ±ã§ã‚ã‚Šã€äºˆæœŸã—ãªã„å•é¡Œã‚„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã®ã§ã€åˆ©ç”¨ã«éš›ã—ã¦ã¯ååˆ†ãªã”ç†è§£ã¨æ³¨æ„ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚
:::

